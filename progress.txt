## Codebase Patterns
- Use `npx tsc --noEmit` for typecheck
- Monorepo uses npm workspaces
- At least one .ts file must exist for typecheck to pass

---

## 2026-01-10 - US-001
Thread: https://ampcode.com/threads/T-019ba8aa-f566-7095-942f-981eb1127ebd
- Created base monorepo directory structure
- Files created:
  - packages/relay-api/package.json (stub)
  - packages/mirror-worker/README.md (placeholder)
  - packages/viewer-web/README.md (placeholder)
  - packages/adapters/.gitkeep
  - packages/shared/schema/.gitkeep
  - packages/shared/types/.gitkeep
  - packages/shared/utils/.gitkeep
  - packages/shared/index.ts (entry point)
  - package.json (root with workspaces)
  - tsconfig.json (root config)
  - .gitignore
- **Learnings for future iterations:**
  - TypeScript requires at least one .ts file to pass typecheck
  - Added packages/shared/index.ts as placeholder
---

## 2026-01-10 - US-002
Thread: https://ampcode.com/threads/T-019ba8ac-72b8-7469-a173-db217fe30342
- Created infra and docs directories
- Files created:
  - infra/migrations/.gitkeep
  - docs/prd/milestone-h0.md (placeholder)
  - docs/crp/crp-v0.1.md (placeholder)
- **Learnings for future iterations:**
  - Simple directory scaffolding doesn't require additional patterns
---

## 2026-01-10 - US-003
Thread: https://ampcode.com/threads/T-019ba8ad-5ee7-7189-8d09-c09ea5b9e84b
- Created shared package with Zod event schema
- Files created/modified:
  - packages/shared/package.json (with zod dependency)
  - packages/shared/schema/event.ts (EventSchema, SourceSchema, and inferred types)
  - packages/shared/index.ts (exports schema and types)
- Removed packages/shared/schema/.gitkeep (no longer needed)
- **Learnings for future iterations:**
  - Use z.string().uuid() for UUID validation
  - Use z.string().datetime() for ISO-8601 timestamp validation
  - Use z.object({}).passthrough() for flexible objects that allow additional fields
  - Sample event validation can be tested with node directly using require('zod')
---

## 2026-01-10 - US-004
Thread: https://ampcode.com/threads/T-019ba8af-0150-751a-be29-a0b00ed57221
- Created database migration for feeds table
- Files created:
  - infra/migrations/001_create_feeds.sql
- **Learnings for future iterations:**
  - Use CREATE TABLE IF NOT EXISTS for idempotent migrations
  - gen_random_uuid() is the Postgres function for default UUID generation
  - JSONB is the preferred type for JSON columns in Postgres
---

## 2026-01-10 - US-005
Thread: https://ampcode.com/threads/T-019ba8b0-00d2-715a-8155-ed55c239abe0
- Created database migration for events table
- Files created:
  - infra/migrations/002_create_events.sql
- **Learnings for future iterations:**
  - Use CREATE INDEX IF NOT EXISTS for idempotent index creation
  - Use REFERENCES for foreign key constraints (e.g., feed_id REFERENCES feeds(id))
  - Partial unique indexes use WHERE clause (e.g., WHERE source_msg_id IS NOT NULL)
---

## 2026-01-10 - US-006
Thread: https://ampcode.com/threads/T-019ba8b0-e1b2-757b-ae77-565967379ddb
- Created relay-api package with Express scaffold
- Files created/modified:
  - packages/relay-api/package.json (with express, pg, typescript dependencies)
  - packages/relay-api/tsconfig.json (extends root config)
  - packages/relay-api/src/index.ts (Express app entry point)
  - packages/relay-api/src/db.ts (Postgres Pool with DATABASE_URL configuration)
- **Learnings for future iterations:**
  - Use `import pg from "pg"; const { Pool } = pg;` for ESM module compatibility
  - DATABASE_URL is checked at startup - process exits if not set
  - relay-api tsconfig extends root and sets rootDir to src
---
