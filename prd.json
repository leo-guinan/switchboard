{
  "project": "Switchboard",
  "branchName": "ralph/milestone-h6",
  "description": "Milestone H6 â€” Minimal Viewer + Mirror Status. Live feed display with mirror sync status.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add GET /feeds endpoint to relay",
      "description": "As a developer, I need to list all feeds so the viewer can show available feeds.",
      "acceptanceCriteria": [
        "GET /feeds returns array of all feeds",
        "Each feed includes id, name, policy_json, created_at",
        "Returns empty array if no feeds exist",
        "Response ordered by created_at descending (newest first)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Add /health endpoint to mirror worker",
      "description": "As a developer, I need the mirror to expose sync status via health endpoint.",
      "acceptanceCriteria": [
        "Mirror starts HTTP server on PORT env var (default 3001)",
        "GET /health returns JSON with status, last_commit_sha, last_event_id, last_event_ts",
        "last_commit_sha is most recent commit pushed (null if none)",
        "last_event_id is ID of most recent event written (null if none)",
        "Includes uptime_seconds and feed_ids array",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create viewer-web package scaffold",
      "description": "As a developer, I need the viewer-web package set up with React and Tailwind.",
      "acceptanceCriteria": [
        "packages/viewer-web/package.json exists with react, react-dom, vite, tailwindcss",
        "packages/viewer-web/vite.config.ts exists",
        "packages/viewer-web/tailwind.config.js exists",
        "packages/viewer-web/postcss.config.js exists",
        "packages/viewer-web/index.html exists",
        "packages/viewer-web/src/main.tsx renders App component",
        "packages/viewer-web/src/App.tsx exists with placeholder content",
        "packages/viewer-web/src/index.css imports Tailwind directives",
        "npm run dev starts Vite dev server on port 5173",
        "Typecheck passes"
      ],
        "priority": 3,
        "passes": true,
        "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create feed list component",
      "description": "As a user, I want to see available feeds so I can select one to view.",
      "acceptanceCriteria": [
        "src/components/FeedList.tsx component exists",
        "Fetches feeds from VITE_RELAY_URL/feeds on mount",
        "Displays each feed as clickable item with name",
        "Shows Loading... while fetching",
        "Shows No feeds available if empty array",
        "Clicking feed calls onSelectFeed prop with feed_id",
        "Selected feed has visual highlight",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create useEventStream hook",
      "description": "As a developer, I need a hook to subscribe to SSE events for a feed.",
      "acceptanceCriteria": [
        "src/hooks/useEventStream.ts exports useEventStream(feedId) hook",
        "Connects to VITE_RELAY_URL/feeds/{feedId}/stream via EventSource",
        "Returns { events, isConnected, error }",
        "events array holds last 100 events (newest first)",
        "Handles connection errors and sets error state",
        "Cleans up EventSource on unmount or feedId change",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create EventCard component",
      "description": "As a user, I want to see events as formatted cards.",
      "acceptanceCriteria": [
        "src/components/EventCard.tsx component exists",
        "Displays type as badge/header",
        "Displays author_identity_id",
        "Displays ts as relative time (e.g., 2 minutes ago)",
        "Displays source.platform as small label",
        "Shows payload preview (first 100 chars) with Show more button",
        "Uses Tailwind: rounded border, padding, shadow-sm",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create RawEventView component",
      "description": "As a user, I want to see events as raw JSON for debugging.",
      "acceptanceCriteria": [
        "src/components/RawEventView.tsx component exists",
        "Displays full event JSON with JSON.stringify(event, null, 2)",
        "Uses monospace font (font-mono)",
        "Each event in pre/code block with background color",
        "Scrollable container if content is long",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Create ViewToggle component",
      "description": "As a user, I want to toggle between card view and raw JSON view.",
      "acceptanceCriteria": [
        "src/components/ViewToggle.tsx component exists",
        "Two buttons/tabs: Cards and Raw JSON",
        "Active view has distinct styling (bg color, border)",
        "Calls onViewChange prop with 'cards' or 'raw'",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Create EventList component",
      "description": "As a user, I want to see events appear in real-time.",
      "acceptanceCriteria": [
        "src/components/EventList.tsx component exists",
        "Uses useEventStream hook with selected feedId",
        "Shows connection status: Connected (green) or Disconnected (red)",
        "Shows event count",
        "Renders EventCard or RawEventView based on viewMode prop",
        "New events appear at top automatically",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Create MirrorStatus component",
      "description": "As a user, I want to see mirror sync status.",
      "acceptanceCriteria": [
        "src/components/MirrorStatus.tsx component exists",
        "Fetches from VITE_MIRROR_URL/health on mount",
        "Displays last_commit_sha (first 7 chars)",
        "Displays last_event_id",
        "Displays last_event_ts as relative time",
        "Shows Mirror offline if fetch fails",
        "Polls every 10 seconds for updates",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Create main App layout",
      "description": "As a user, I want a cohesive layout combining all components.",
      "acceptanceCriteria": [
        "App.tsx has header with Switchboard Viewer title",
        "Sidebar contains FeedList and MirrorStatus",
        "Main area contains ViewToggle and EventList",
        "Shows Select a feed message when no feed selected",
        "Layout uses Tailwind grid or flex",
        "Responsive: sidebar stacks above main on small screens",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add viewer-web to docker-compose",
      "description": "As a developer, I want to run viewer with docker-compose.",
      "acceptanceCriteria": [
        "packages/viewer-web/Dockerfile exists",
        "Uses node base image, runs npm run build, serves with nginx or serve",
        "infra/docker-compose.yml has viewer-web service",
        "Viewer accessible on port 5173",
        "VITE_RELAY_URL and VITE_MIRROR_URL configured for container network",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Configure nginx reverse proxy for API routes",
      "description": "As a developer, I need nginx to proxy API calls to avoid CORS issues.",
      "acceptanceCriteria": [
        "packages/viewer-web/nginx.conf exists",
        "Proxies /api/* to http://relay-api:3000/* (strips /api prefix)",
        "Proxies /mirror/* to http://mirror-worker:3001/* (strips /mirror prefix)",
        "Serves static files from /usr/share/nginx/html for all other routes",
        "Handles SPA routing (try_files $uri /index.html)",
        "Dockerfile uses nginx.conf in final image",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Update viewer to use relative API URLs",
      "description": "As a developer, I need the viewer to use proxied paths instead of direct URLs.",
      "acceptanceCriteria": [
        "FeedList fetches from /api/feeds (relative path)",
        "useEventStream connects to /api/feeds/{feedId}/stream",
        "MirrorStatus fetches from /mirror/health",
        "Remove or ignore VITE_RELAY_URL and VITE_MIRROR_URL env vars",
        "All API calls work through nginx proxy",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Add mirror-worker service to docker-compose",
      "description": "As a developer, I need mirror-worker running in compose for viewer to show status.",
      "acceptanceCriteria": [
        "packages/mirror-worker/Dockerfile exists",
        "infra/docker-compose.yml has mirror-worker service",
        "Mirror-worker depends on relay-api",
        "Configures RELAY_URL, FEED_IDS, CONTEXT_REPO_PATH, PORT=3001",
        "Creates /data/context-repo volume for git repo",
        "Health endpoint accessible at mirror-worker:3001/health from nginx",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Verify full stack works via docker-compose",
      "description": "As a developer, I want to verify the complete system works end-to-end.",
      "acceptanceCriteria": [
        "docker compose up starts postgres, relay-api, mirror-worker, viewer-web",
        "Viewer loads at http://localhost:5173",
        "Feed list loads without CORS errors",
        "Mirror status shows (not 'Mirror offline')",
        "Creating feed and posting event shows in viewer live",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 16,
      "passes": false,
      "notes": ""
    }
  ]
}
